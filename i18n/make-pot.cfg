# Output file name
FPOT=$PACKAGE_NAME-$PACKAGE_POT_LANGUAGE.pot
# Input encoding
IENC=UTF-8
# Output encoding
OENC=UTF-8

# Firstly $XSRC source file is scanned for MSGIDs with xgettext $XOPT (default
# --from-code=$IENC -L Shell)
XSRC=../docs/$PACKAGE_NAME
#XOPT="-ci18n --no-location"

# Then $XTBL source file is scanned for MSGIDs with $XXGT (default
# --from-code=$IENC -L Shell)
XTBL=./i18n_table-en.sh
XXGT=./xgettext.sh
#XXGTOPT="-- -ci18n --no-location"

# Multiple files in list_md_files() are scanned for MSGIDs with mdview --po {{{2
list_md_files()
{
  local d=../docs
  ! [ -d "$d" ] || return
  set +f
  printf "%s\n" "$d/"*.md
}

# A markdown file that fails the this test will be skipped {{{2
md_is_to_be_translated() # $1-filepath
{
  case $f in
    */TRANSLATING.md)
      : "$f targets translators - they can read English documentation"
      ;;
    */examples/*)
      : "$f targets users - maybe translate examples in a future release"
      ;;
    */LICENSE.md)
      : "keep $f in English because GNU GPL does not endorse translations of its license"
      ;;
    *)
      : "$f targets users and is to be translated"
      return 0
      ;;
  esac
  return 1
}

# --- Required pot header settings --------------------------------------- {{{1

PACKAGE_VERSION=$(grep 'sh_ver="' < $XSRC |awk -F "=" '{print $NF}'|$GSED 's/\"//g'|head -1)
PACKAGE_TITLE="$PACKAGE_NAME v$PACKAGE_VERSION - ONE Click Script"
PACKAGE_COPYRIGHT="BSD 3 Clause License"
PACKAGE_FIRST_POT_AUTHOR="MTimer"
PACKAGE_POT_CREATION_TZ="UTC"
PACKAGE_CHARSET="$OENC"
PACKAGE_POT_BUGS_ADDRESS="tg @woniuzfb"

# --- Functions ----------------------------------------------------- {{{1

# Function __notes_on_pot_file is called to insert starting notes ahead of
# extracted MSGIDs.
__notes_on_pot_file() {

  # your notes here ...

  # this is always good to have
echo '
#. Notes for translators
#. ---------------------
#. This pot file was created with xgettext.sh[1] instead of xgettext.
#. [1] https://github.com/step-/i18n-table
#.
#. A. Never use \\n **inside** your MSGSTR. For yad and gtkdialog replace \\n with \\r.
#. B. However, always **end** your MSGSTR with \\n.
#. C. Replace trailing spaces (U+0020) with non-breaking spaces (U+00A0).
'

  # boilerplate for markdown files, if any
  [ "$(list_md_files)" ] && echo '
#. Example of Plural-Forms valid for English; adapt to your target language:
#.   "Plural-Forms: nplurals=2; plural=(n != 1);\\n"
#.
#. =======================================================================
#. i18n User documentation in markdown format from .md files follows.
#. i18n IMPORTANT! Reproduce indentation and special punctuation exactly.
#. =======================================================================
#.
'

  # further notes here ...
}

# For each scanned <filename>.ext __notes_on_<filename> is called to insert
# notes ahead of its extracted MSGIDs unless the line where
# __notes_on_file_<filename> appears includes the word "excluded" (without
# quotes) somewhere. Example:
__notes_on_file_LICENSE() { # is excluded from the pot file
  echo "
#. i18n File LICENSE.md is a special case. Do not to translate it. Instead
#. i18n find a translation from http://www.gnu.org/licenses/translations.html
#. i18n and use that translated text here.
#.
"
}

# --- Modelines ----------------------------------------------------- {{{1
# vim:ft=sh:
